<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Envoi de SMS - dikra Centre dentaire</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../../navbar.css">

<style>
/* Professional SMS Interface Styles */
:root {
  --sms-primary: #25d366;
  --sms-primary-dark: #128c7e;
  --sms-light: #f0f9f0;
  --sms-border: #e0e0e0;
  --sms-success: #10b981;
  --sms-warning: #f59e0b;
  --sms-error: #ef4444;
}

.sms-container {
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: 2rem;
  height: calc(100vh - 2rem);
}

.sms-composer {
  background: white;
  border-radius: var(--border-radius);
  box-shadow: var(--card-shadow);
  padding: 2rem;
  display: flex;
  flex-direction: column;
}

.composer-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--sms-border);
}

.composer-icon {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, var(--sms-primary), var(--sms-primary-dark));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.5rem;
}

.composer-title {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-primary);
}

.recipient-section {
  margin-bottom: 2rem;
}

.section-title {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.recipient-input-group {
  display: flex;
  gap: 1rem;
  margin-bottom: 1rem;
}

.recipient-input {
  flex: 1;
  padding: 0.75rem;
  border: 1px solid var(--sms-border);
  border-radius: 0.5rem;
  font-size: 0.9rem;
  transition: border-color 0.2s;
}

.recipient-input:focus {
  outline: none;
  border-color: var(--sms-primary);
  box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);
}

.add-recipient-btn {
  padding: 0.75rem 1rem;
  background: var(--sms-light);
  border: 1px solid var(--sms-primary);
  border-radius: 0.5rem;
  color: var(--sms-primary);
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 500;
  transition: all 0.2s;
}

.add-recipient-btn:hover {
  background: var(--sms-primary);
  color: white;
}

.recipient-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 1rem;
}

.recipient-tag {
  background: var(--sms-light);
  color: var(--sms-primary);
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.8rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.tag-remove {
  cursor: pointer;
  color: var(--sms-primary);
  font-weight: bold;
}

.message-section {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.message-textarea {
  width: 100%;
  min-height: 120px;
  padding: 1rem;
  border: 1px solid var(--sms-border);
  border-radius: 0.5rem;
  font-size: 0.95rem;
  line-height: 1.5;
  resize: vertical;
  transition: border-color 0.2s;
  font-family: inherit;
}

.message-textarea:focus {
  outline: none;
  border-color: var(--sms-primary);
  box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);
}

.message-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1rem;
}

.char-counter {
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.char-counter.warning {
  color: var(--sms-warning);
}

.char-counter.error {
  color: var(--sms-error);
}

.send-button {
  padding: 0.75rem 2rem;
  background: var(--sms-primary);
  color: white;
  border: none;
  border-radius: 0.5rem;
  font-size: 1rem;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.send-button:hover:not(:disabled) {
  background: var(--sms-primary-dark);
}

.send-button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.templates-section {
  margin-bottom: 2rem;
}

.templates-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.template-card {
  background: var(--sms-light);
  border: 1px solid var(--sms-border);
  border-radius: 0.5rem;
  padding: 1rem;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
}

.template-card:hover {
  border-color: var(--sms-primary);
  background: white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.template-icon {
  font-size: 1.5rem;
  color: var(--sms-primary);
  margin-bottom: 0.5rem;
}

.template-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
}

.sms-history {
  background: white;
  border-radius: var(--border-radius);
  box-shadow: var(--card-shadow);
  padding: 2rem;
  display: flex;
  flex-direction: column;
}

.history-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--sms-border);
}

.history-title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
}

.history-stats {
  display: flex;
  gap: 1rem;
}

.stat-item {
  text-align: center;
}

.stat-number {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--sms-primary);
  display: block;
}

.stat-label {
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.history-list {
  flex: 1;
  overflow-y: auto;
}

.empty-history {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--text-secondary);
}

.empty-icon {
  font-size: 3rem;
  color: #e0e0e0;
  margin-bottom: 1rem;
}

.empty-text {
  font-size: 1rem;
  margin: 0;
}

.history-item {
  padding: 1rem;
  border-bottom: 1px solid var(--sms-border);
  transition: background 0.2s;
}

.history-item:hover {
  background: var(--bg-primary);
}

.history-item:last-child {
  border-bottom: none;
}

.history-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.history-recipient {
  font-weight: 600;
  color: var(--text-primary);
}

.history-time {
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.history-message {
  color: var(--text-primary);
  line-height: 1.4;
  margin-bottom: 0.5rem;
}

.history-status {
  font-size: 0.8rem;
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
  font-weight: 500;
}

.status-sent {
  background: rgba(16, 185, 129, 0.1);
  color: var(--sms-success);
}

.status-failed {
  background: rgba(239, 68, 68, 0.1);
  color: var(--sms-error);
}

.status-pending {
  background: rgba(245, 158, 11, 0.1);
  color: var(--sms-warning);
}

/* Responsive */
@media (max-width: 1024px) {
  .sms-container {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  .sms-history {
    order: -1;
  }
}

@media (max-width: 768px) {
  .sms-composer {
    padding: 1.5rem;
  }
  .composer-header {
    flex-direction: column;
    text-align: center;
    gap: 0.5rem;
  }
  .recipient-input-group {
    flex-direction: column;
  }
  .templates-grid {
    grid-template-columns: 1fr;
  }
  .history-stats {
    flex-direction: column;
    gap: 0.5rem;
  }
}
</style>

</head>
<body class="light-mode">

<div class="sidebar">
    <div class="cabinet-header"><div class="cabinet-logo"><img src="../../../Photo/Photo.png" alt="Logo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"></div>
        
        <div class="cabinet-name">DIKRA centre Dentaire</div>
        <div class="cabinet-subtitle">Casablanca, Maroc</div>
    </div>
    <ul class="sidebar-menu">
        <li class="sidebar-item">
            <a href="dashboard.html" class="sidebar-link">
                <span class="sidebar-icon"><i class="fas fa-home"></i></span>
                Tableau de bord
            </a>
        </li>

        <li class="sidebar-section">
            <div class="section-header clickable" id="section-rdv-toggle">
                Rendez-vous
                <i class="fas fa-chevron-down section-chevron"></i>
            </div>
            <div class="section-content" id="section-rdv-content">
                <div class="sidebar-item">
                    <a href="Listes%20des%20Rendez-vous.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-calendar-check"></i></span>
                        Liste des rendez-vous
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="Prise%20en%20ligne.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-globe"></i></span>
                        Prise en ligne
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="En%20pr√©sentiel.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-building"></i></span>
                        En pr√©sentiel
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="via-espace-patient.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-user-shield"></i></span>
                        Via espace patient
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="planning-equipe.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-calendar-week"></i></span>
                        Planning de l'√©quipe
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="salle-attente.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-clock"></i></span>
                        Salle d'attente
                    </a>
                </div>
            </div>
        </li>

        <li class="sidebar-section">
            <div class="section-header clickable" id="section-patients-toggle">
                Patients
                <i class="fas fa-chevron-down section-chevron"></i>
            </div>
            <div class="section-content" id="section-patients-content">
                <div class="sidebar-item">
                    <a href="fiches-patients.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-user-injured"></i></span>
                        Fiches patients
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="dossiers-medicaux.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-folder-open"></i></span>
                        Dossiers m√©dicaux
                    </a>
                </div>
            </div>
        </li>

        <li class="sidebar-section">
            <div class="section-header clickable" id="section-cabinet-toggle">
                Cabinet
                <i class="fas fa-chevron-down section-chevron"></i>
            </div>
            <div class="section-content" id="section-cabinet-content">
                <div class="sidebar-item">
                    <a href="salle-attente.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-chair"></i></span>
                        Salle d'attente
                    </a>
                </div>
            </div>
        </li>

        <li class="sidebar-section">
            <div class="section-header clickable" id="section-com-toggle">
                Communication
                <i class="fas fa-chevron-down section-chevron"></i>
            </div>
            <div class="section-content" id="section-com-content">
                <div class="sidebar-item">
                    <a href="messagerie-interne.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-comments"></i></span>
                        Messagerie interne
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="assistant-ia.html" class="sidebar-link">
                        <span class="sidebar-icon">
                            <div class="ai-agent-icon"><i class="fas fa-robot"></i></div>
                        </span>
                        Assistant IA
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="envoi-sms.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-sms"></i></span>
                        Envoi de SMS
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="notifications.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-bell"></i></span>
                        Notifications
                    </a>
                </div>
            </div>
        </li>

        <li class="sidebar-section">
            <div class="section-header clickable" id="section-org-toggle">
                Organisation
                <i class="fas fa-chevron-down section-chevron"></i>
            </div>
            <div class="section-content" id="section-org-content">
                <div class="sidebar-item">
                    <a href="taches-rappels.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-tasks"></i></span>
                        T√¢ches & rappels
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="notes-personnelles.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-sticky-note"></i></span>
                        Notes personnelles
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="statistiques.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-chart-bar"></i></span>
                        Statistiques
                    </a>
                </div>
            </div>
        </li>

        <li class="sidebar-section">
            <div class="section-header clickable" id="section-stock-toggle">
                Gestion des stocks
                <i class="fas fa-chevron-down section-chevron"></i>
            </div>
            <div class="section-content" id="section-stock-content">
                <div class="sidebar-item">
                    <a href="materiel-dentaire.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-box"></i></span>
                        Mat√©riel dentaire
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="consommables.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-vial"></i></span>
                        Consommables
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="medicaments.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-pills"></i></span>
                        M√©dicaments
                    </a>
                </div>
            </div>
        </li>

        <li class="sidebar-section">
            <div class="section-header clickable" id="section-docs-toggle">
                Documents & formulaires
                <i class="fas fa-chevron-down section-chevron"></i>
            </div>
            <div class="section-content" id="section-docs-content">
                <div class="sidebar-item">
                    <a href="ordonnances.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-prescription"></i></span>
                        Ordonnances
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="certificats-medicaux.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-file-medical"></i></span>
                        Certificats m√©dicaux
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="feuilles-de-soins.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-file-invoice"></i></span>
                        Feuilles de soins (CNOPS/CNSS)
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="imagerie-medicale.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-x-ray"></i></span>
                        Imagerie m√©dicale
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="protheses.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-teeth"></i></span>
                        Proth√®ses
                    </a>
                </div>
            </div>
        </li>

        <li class="sidebar-section">
            <div class="section-header clickable" id="section-users-toggle">
                Utilisateurs
                <i class="fas fa-chevron-down section-chevron"></i>
            </div>
            <div class="section-content" id="section-users-content">
                <div class="sidebar-item">
                    <a href="Liste%20du%20personnel.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-list"></i></span>
                        Liste du personnel
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="ajouter-un-membre.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-user-plus"></i></span>
                        Ajouter un membre
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="roles-permissions.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-shield-alt"></i></span>
                        R√¥les & permissions
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="planning-equipe.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-calendar-check"></i></span>
                        Planning de l'√©quipe
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="parametres-espace-patient.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-cog"></i></span>
                        Param√®tres espace patient
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="gestion-des-acces.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-key"></i></span>
                        Gestion des acc√®s
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="dossiers-medicaux.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-file-medical"></i></span>
                        Dossiers m√©dicaux
                    </a>
                </div>
            </div>
        </li>


        <li class="sidebar-section">
            <div class="section-header clickable" id="section-config-toggle">
                Configuration
                <i class="fas fa-chevron-down section-chevron"></i>
            </div>
            <div class="section-content" id="section-config-content">
                <div class="sidebar-item">
                    <a href="mon-profil.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-user-cog"></i></span>
                        Mon profil
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="informations-cabinet.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-building"></i></span>
                        Informations cabinet
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="notifications.html" class="sidebar-link">
                        <span class="sidebar-icon"><i class="fas fa-bell"></i></span>
                        Notifications
                    </a>
                </div>
            </div>
        </li>
    </ul>
    <div class="user-section">
        <div class="user-info">
            <div class="user-avatar"></div>
            <div class="user-details">
                <div class="user-name"></div>
                <div class="user-role">Assistante</div>
            </div>
        </div>
        <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i>
            <span>Mode Sombre</span>
        </button>
        <button class="logout-btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            <span>D√©connexion</span>
        </button>
    </div>
</div>
<div class="main-content">
<div class="sms-container">
  <!-- SMS Composer -->
  <div class="sms-composer">
    <div class="composer-header">
      <div class="composer-icon">
        <i class="fas fa-sms"></i>
      </div>
      <h1 class="composer-title">Envoyer un SMS</h1>
    </div>

    <!-- Templates Section -->
    <div class="templates-section">
      <h3 class="section-title">
        <i class="fas fa-bookmark"></i>
        Mod√®les de messages
      </h3>
      <div class="templates-grid">
        <div class="template-card" onclick="useTemplate('rappel')">
          <div class="template-icon">üìÖ</div>
          <h4 class="template-title">Rappel RDV</h4>
        </div>
        <div class="template-card" onclick="useTemplate('confirmation')">
          <div class="template-icon">‚úÖ</div>
          <h4 class="template-title">Confirmation</h4>
        </div>
        <div class="template-card" onclick="useTemplate('urgence')">
          <div class="template-icon">üö®</div>
          <h4 class="template-title">Urgence</h4>
        </div>
        <div class="template-card" onclick="useTemplate('promotion')">
          <div class="template-icon">üéâ</div>
          <h4 class="template-title">Promotion</h4>
        </div>
      </div>
    </div>

    <!-- Recipients Section -->
    <div class="recipient-section">
      <h3 class="section-title">
        <i class="fas fa-users"></i>
        Destinataires
      </h3>
      <div class="recipient-input-group">
        <input type="tel" class="recipient-input" id="recipientInput" placeholder="+212 6XX XXX XXX">
        <button class="add-recipient-btn" onclick="addRecipient()">
          <i class="fas fa-plus"></i> Ajouter
        </button>
      </div>
      <div class="recipient-tags" id="recipientTags"></div>
    </div>

    <!-- Message Section -->
    <div class="message-section">
      <h3 class="section-title">
        <i class="fas fa-comment"></i>
        Message
      </h3>
      <textarea
        class="message-textarea"
        id="messageTextarea"
        placeholder="Tapez votre message ici..."
        maxlength="160"
      ></textarea>
      <div class="message-footer">
        <div class="char-counter" id="charCounter">0/160 caract√®res</div>
        <button class="send-button" id="sendButton" onclick="sendSMS()" disabled>
          <i class="fas fa-paper-plane"></i>
          Envoyer SMS
        </button>
      </div>
    </div>
  </div>

  <!-- SMS History -->
  <div class="sms-history">
    <div class="history-header">
      <h2 class="history-title">Historique des SMS</h2>
      <div class="history-stats">
        <div class="stat-item">
          <span class="stat-number" id="totalSent">0</span>
          <span class="stat-label">Envoy√©s</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="totalPending">0</span>
          <span class="stat-label">En attente</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="totalFailed">0</span>
          <span class="stat-label">√âchou√©s</span>
        </div>
      </div>
    </div>

    <div class="history-list" id="historyList">
      <div class="empty-history">
        <div class="empty-icon">
          <i class="fas fa-inbox"></i>
        </div>
        <p class="empty-text">Aucun SMS envoy√© pour le moment</p>
      </div>
    </div>
  </div>
</div>
</div>

<script>
// Professional SMS Interface Functionality
let recipients = [];
let smsHistory = JSON.parse(localStorage.getItem('smsHistory')) || [];
let smsStats = JSON.parse(localStorage.getItem('smsStats')) || {
  sent: 0,
  pending: 0,
  failed: 0
};

// SMS Templates
const smsTemplates = {
  rappel: "Bonjour, rappel de votre rendez-vous demain √† [heure] au DIKRA centre Dentaire. Merci de confirmer.",
  confirmation: "Votre rendez-vous du [date] √† [heure] est confirm√©. Au plaisir de vous accueillir !",
  urgence: "DIKRA centre Dentaire - En cas d'urgence dentaire, contactez-nous au 05XX XX XX XX.",
  promotion: "D√©couvrez nos nouvelles offres ! Consultation gratuite pour les nouveaux patients. R√©servez d√®s maintenant !"
};

// DOM elements
const recipientInput = document.getElementById('recipientInput');
const recipientTags = document.getElementById('recipientTags');
const messageTextarea = document.getElementById('messageTextarea');
const charCounter = document.getElementById('charCounter');
const sendButton = document.getElementById('sendButton');
const historyList = document.getElementById('historyList');
const totalSent = document.getElementById('totalSent');
const totalPending = document.getElementById('totalPending');
const totalFailed = document.getElementById('totalFailed');

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  setupEventListeners();
  updateUI();
  updateCharCounter();
});

// Setup event listeners
function setupEventListeners() {
  recipientInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      addRecipient();
    }
  });

  messageTextarea.addEventListener('input', updateCharCounter);
  messageTextarea.addEventListener('input', updateSendButton);
}

// Add recipient
function addRecipient() {
  const phone = recipientInput.value.trim();
  if (!phone) return;

  // Basic phone validation
  const phoneRegex = /^(\+212|0)[6-7]\d{8}$/;
  if (!phoneRegex.test(phone.replace(/\s/g, ''))) {
    alert('Veuillez entrer un num√©ro de t√©l√©phone valide (format: +212 6XX XXX XXX ou 06XX XXX XXX)');
    return;
  }

  if (!recipients.includes(phone)) {
    recipients.push(phone);
    updateRecipientTags();
    recipientInput.value = '';
    updateSendButton();
  }
}

// Update recipient tags
function updateRecipientTags() {
  recipientTags.innerHTML = '';
  recipients.forEach((recipient, index) => {
    const tag = document.createElement('div');
    tag.className = 'recipient-tag';
    tag.innerHTML = `
      ${recipient}
      <span class="tag-remove" onclick="removeRecipient(${index})">√ó</span>
    `;
    recipientTags.appendChild(tag);
  });
}

// Remove recipient
function removeRecipient(index) {
  recipients.splice(index, 1);
  updateRecipientTags();
  updateSendButton();
}

// Use template
function useTemplate(templateKey) {
  const template = smsTemplates[templateKey];
  if (template) {
    messageTextarea.value = template;
    updateCharCounter();
    updateSendButton();
    messageTextarea.focus();
  }
}

// Update character counter
function updateCharCounter() {
  const length = messageTextarea.value.length;
  const maxLength = 160;
  charCounter.textContent = `${length}/${maxLength} caract√®res`;

  if (length > maxLength * 0.9) {
    charCounter.className = 'char-counter error';
  } else if (length > maxLength * 0.8) {
    charCounter.className = 'char-counter warning';
  } else {
    charCounter.className = 'char-counter';
  }
}

// Update send button
function updateSendButton() {
  const hasRecipients = recipients.length > 0;
  const hasMessage = messageTextarea.value.trim().length > 0;
  const isValidLength = messageTextarea.value.length <= 160;

  sendButton.disabled = !hasRecipients || !hasMessage || !isValidLength;
}

// Send SMS
async function sendSMS() {
  if (sendButton.disabled) return;

  const message = messageTextarea.value.trim();
  if (!message || recipients.length === 0) return;

  // Disable send button
  sendButton.disabled = true;
  sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Envoi en cours...';

  try {
    // Simulate sending SMS to each recipient
    for (const recipient of recipients) {
      await sendSingleSMS(recipient, message);
    }

    // Clear form
    recipients = [];
    messageTextarea.value = '';
    updateRecipientTags();
    updateCharCounter();
    updateSendButton();

    alert(`SMS envoy√© avec succ√®s √† ${recipients.length} destinataire(s) !`);

  } catch (error) {
    alert('Erreur lors de l\'envoi des SMS. Veuillez r√©essayer.');
    console.error('SMS Error:', error);
  } finally {
    sendButton.disabled = false;
    sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> Envoyer SMS';
  }
}

// Send single SMS (simulated)
async function sendSingleSMS(recipient, message) {
  // Simulate API delay
  await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));

  // Simulate random success/failure (90% success rate)
  const success = Math.random() > 0.1;

  const smsRecord = {
    id: Date.now() + Math.random(),
    recipient: recipient,
    message: message,
    timestamp: new Date(),
    status: success ? 'sent' : 'failed'
  };

  smsHistory.unshift(smsRecord);

  if (success) {
    smsStats.sent++;
  } else {
    smsStats.failed++;
  }

  saveData();
  updateUI();
}

// Update UI
function updateUI() {
  updateHistory();
  updateStats();
}

// Update history
function updateHistory() {
  if (smsHistory.length === 0) {
    historyList.innerHTML = `
      <div class="empty-history">
        <div class="empty-icon">
          <i class="fas fa-inbox"></i>
        </div>
        <p class="empty-text">Aucun SMS envoy√© pour le moment</p>
      </div>
    `;
    return;
  }

  historyList.innerHTML = '';
  smsHistory.slice(0, 50).forEach(sms => { // Show last 50
    const item = document.createElement('div');
    item.className = 'history-item';

    const statusClass = sms.status === 'sent' ? 'status-sent' :
                       sms.status === 'failed' ? 'status-failed' : 'status-pending';
    const statusText = sms.status === 'sent' ? 'Envoy√©' :
                      sms.status === 'failed' ? '√âchou√©' : 'En attente';

    item.innerHTML = `
      <div class="history-meta">
        <div class="history-recipient">${sms.recipient}</div>
        <div class="history-time">${formatTime(sms.timestamp)}</div>
      </div>
      <div class="history-message">${sms.message}</div>
      <div class="history-status ${statusClass}">${statusText}</div>
    `;

    historyList.appendChild(item);
  });
}

// Update stats
function updateStats() {
  totalSent.textContent = smsStats.sent;
  totalPending.textContent = smsStats.pending;
  totalFailed.textContent = smsStats.failed;
}

// Format time
function formatTime(date) {
  const d = new Date(date);
  const now = new Date();
  const diff = now - d;

  if (diff < 60000) return '√Ä l\'instant';
  if (diff < 3600000) return `Il y a ${Math.floor(diff / 60000)} min`;
  if (diff < 86400000) return d.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
  return d.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' });
}

// Save data
function saveData() {
  localStorage.setItem('smsHistory', JSON.stringify(smsHistory));
  localStorage.setItem('smsStats', JSON.stringify(smsStats));
}

/*
 * SMS API Integration Structure
 *
 * To integrate with a real SMS service, replace sendSingleSMS() with:
 *
 * async function sendSingleSMS(recipient, message) {
 *   try {
 *     const response = await fetch('/api/sms/send', {
 *       method: 'POST',
 *       headers: {
 *         'Content-Type': 'application/json',
 *       },
 *       body: JSON.stringify({
 *         to: recipient,
 *         message: message
 *       })
 *     });
 *
 *     const result = await response.json();
 *
 *     const smsRecord = {
 *       id: Date.now(),
 *       recipient: recipient,
 *       message: message,
 *       timestamp: new Date(),
 *       status: result.success ? 'sent' : 'failed',
 *       apiId: result.messageId
 *     };
 *
 *     smsHistory.unshift(smsRecord);
 *     if (result.success) smsStats.sent++;
 *     else smsStats.failed++;
 *
 *     saveData();
 *     updateUI();
 *
 *   } catch (error) {
 *     // Handle error
 *     smsStats.failed++;
 *     saveData();
 *     updateUI();
 *     throw error;
 *   }
 * }
 */
</script>

</body>
</html>










































